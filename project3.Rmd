---
title: 'TMA4315: Project 3'
author: "jototlan@stud.ntnu.no (10018), martigtu@stud.ntnu.no (10037)"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load data:
```{r}
long <- read.csv("https://www.math.ntnu.no/emner/TMA4315/2020h/eliteserie.csv", colClasses = c("factor","factor","factor","numeric"))
head(long)
```
# a)
We consider the model
```{r}
library(glmmTMB)
mod <- glmmTMB(goals ~ home + (1|attack) + (1|defence),  poisson, data=long, REML=TRUE)
```

The distributional assumption on the $i$'th response (number of goals) is $y_{i} \sim \mathrm{Poisson}(\lambda_{i})$. The mean is connected to the covariates:

$$
\lambda_i = \exp\left(\beta_h x_{i} + \gamma_{j(i)}^\text{attack} + \gamma_{k(i)}^{\text{defence}} + \varepsilon_{i}\right).
$$

Here, $\beta_h$ is the effect of playing home,  $\gamma_{j(i)}^\text{attack}$ is the effect of team $j(i)$ attacking, $\gamma_{k(i)}^{\text{defence}}$ is the effect of team $k(i)$ defending, and $\varepsilon_{i}$ is the error term. The distributional assumption is reasonable, since the number of goals is discrete, and one could argue that the time between goals is independent (exponentially distributed). One could, however, argue that this is not the case, for example because a team is more likely to score right after having conceded a goal.

```{r}

```

# b)

```{r}
summary(mod)
ranef(mod)
```


## Marginal variance and intraclass covariance probit model via pmvnorm

```{r}
#install.packages("mvtnorm")
library(mvtnorm) # to use pmvnorm()
```

## Power of correct mixed vs misspecified fixed effect model vs pseudoreplication

## Numerical computation of the critical value for LRT test of random slope



